<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bahati Spin - Test Mode</title>
    <style>
        body { display: flex; flex-direction: column; align-items: center; background: #050505; font-family: 'Segoe UI', sans-serif; color: white; padding: 15px; margin: 0; }
        
        .lang-bar { width: 100%; display: flex; justify-content: flex-end; gap: 8px; margin-bottom: 15px; }
        .lang-btn { background: #111; border: 1px solid #333; color: #666; padding: 5px 12px; border-radius: 5px; font-size: 11px; cursor: pointer; }
        .lang-btn.active { background: gold; color: black; border-color: gold; font-weight: bold; }

        .header-box { width: 100%; display: flex; justify-content: space-between; margin-bottom: 10px; }
        .stat-card { background: #111; padding: 12px; border-radius: 10px; border: 1px solid #333; color: gold; font-weight: bold; font-size: 14px; flex: 1; text-align: center; margin: 0 5px; }

        .wheel-container { position: relative; width: 260px; height: 260px; margin: 20px 0; }
        .pointer { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 25px solid #ff0000; z-index: 100; }
        #wheel { width: 100%; height: 100%; border-radius: 50%; border: 6px solid #333; position: relative; overflow: hidden; transition: transform 5s cubic-bezier(0.15, 0, 0, 1); background: #1a1a1a; }
        .segment { position: absolute; width: 50%; height: 50%; transform-origin: 100% 100%; left: 0; top: 0; display: flex; align-items: center; justify-content: center; }

        #spin-btn { width: 95%; padding: 18px; border-radius: 50px; border: none; font-weight: bold; font-size: 16px; cursor: pointer; background: linear-gradient(135deg, #f1c40f, #f39c12); color: black; }
        
        /* Available Gifts Display */
        .gift-box { width: 100%; background: #111; border: 1px solid #222; border-radius: 12px; padding: 10px; margin-top: 15px; box-sizing: border-box; }
        .gift-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top: 8px; }
        .g-item { background: #000; padding: 8px; border-radius: 6px; font-size: 10px; text-align: center; color: gold; border: 0.5px solid #333; }

        /* Withdrawal History */
        .record-box { width: 100%; background: #0a0a0a; border: 1px solid #222; border-radius: 12px; padding: 15px; margin-top: 15px; box-sizing: border-box; }
        .v-item { display: flex; justify-content: space-between; align-items: center; font-size: 13px; padding: 10px 0; border-bottom: 1px solid #111; }
        .claim-btn { background: #25d366; color: white; padding: 6px 12px; border-radius: 6px; text-decoration: none; font-size: 11px; font-weight: bold; }
        .used-btn { background: #222; color: #555; padding: 6px 12px; border-radius: 6px; font-size: 11px; pointer-events: none; }

        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #111; border: 2px solid gold; padding: 25px; border-radius: 20px; z-index: 1000; width: 85%; text-align: center; }
    </style>
</head>
<body>

    <div class="lang-bar">
        <button class="lang-btn active" id="lang-sw" onclick="setLang('sw')">SWAHILI</button>
        <button class="lang-btn" id="lang-en" onclick="setLang('en')">ENGLISH</button>
    </div>

    <div id="popup" class="modal">
        <h2 id="p-title" style="margin-top:0; color: gold;"></h2>
        <p id="p-body"></p>
        <div id="claim-area"></div>
        <button onclick="closePopup()" style="background: none; border: 1px solid #444; color: #888; padding: 10px; border-radius: 8px; width: 100%; margin-top: 10px;">FUNGA</button>
    </div>

    <div class="header-box">
        <div class="stat-card">COINS: <span id="coin-count">0</span> ðŸª™</div>
        <div class="stat-card">TEST MODE: ON âœ…</div>
    </div>

    <div class="wheel-container">
        <div class="pointer"></div>
        <div id="wheel"></div>
    </div>

    <button id="spin-btn" onclick="doSpin()">SPIN SASA</button>

    <div class="gift-box">
        <span style="font-size: 11px; color: #666; text-transform: uppercase;">ZAWADI ZILIZOPO / GIFTS</span>
        <div class="gift-grid">
            <div class="g-item">Vocha 600</div>
            <div class="g-item">Vocha 500</div>
            <div class="g-item">Vocha 200</div>
            <div class="g-item">100 Coins</div>
            <div class="g-item">50 Coins</div>
            <div class="g-item">Try Again</div>
        </div>
    </div>

    <div class="record-box">
        <span style="font-size: 11px; color: #666; text-transform: uppercase;">HISTORIA YA USHINDI</span>
        <div id="v-list"></div>
    </div>

    <script>
        // WEKA NAMBA YAKO HAPA
        const WHATSAPP_NUMBER = "255767123456"; 

        let coins = 500; // Nimekuwekea Coins nyingi za kujaribu
        let lang = 'sw';

        const segments = [
            {t: "Vocha 600", v: 600, type: 'v'}, 
            {t: "Try Again", type: 'f'},
            {t: "Vocha 500", v: 500, type: 'v'}, 
            {t: "50 Coins", v: 50, type: 'c'},
            {t: "Vocha 200", v: 200, type: 'v'}, 
            {t: "100 Coins", v: 100, type: 'c'}
        ];

        const wheel = document.getElementById('wheel');
        segments.forEach((s, i) => {
            const el = document.createElement('div');
            el.className = 'segment';
            el.style.transform = `rotate(${i * 60}deg) skewY(30deg)`;
            el.style.backgroundColor = (i % 2 == 0) ? "#0a0a0a" : "#151515";
            wheel.appendChild(el);
        });

        function updateUI() {
            document.getElementById('coin-count').innerText = coins;
            renderHistory();
        }

        function doSpin() {
            if(coins < 100) { alert("Huna Coins! Refresh App upate nyingine za bure."); return; }
            coins -= 100;
            updateUI();

            const btn = document.getElementById('spin-btn');
            btn.disabled = true;
            btn.innerText = "INAZUNGUKA...";

            const deg = 3600 + Math.floor(Math.random() * 3600);
            wheel.style.transform = `rotate(${deg}deg)`;

            setTimeout(() => {
                // EASY MODE: 75% Chance ya kushinda vocha
                let r = Math.random() * 100;
                let res;
                if (r < 40) res = segments[0];      // Vocha 600
                else if (r < 75) res = segments[2]; // Vocha 500
                else if (r < 90) res = segments[4]; // Vocha 200
                else res = segments[1];             // Try again

                if (res.type === 'v') {
                    let id = Math.floor(1000 + Math.random() * 9000);
                    saveWin(res.v, id);
                    showWinPopup(res.v, id);
                } else {
                    pop("POLE!", "Leo huna bahati, jaribu tena!");
                }
                
                btn.disabled = false;
                btn.innerText = "SPIN SASA";
                updateUI();
            }, 5200);
        }

        function showWinPopup(val, id) {
            const t = lang === 'sw' ? "HONGERA!" : "CONGRATS!";
            const b = lang === 'sw' ? `Umeshinda Vocha ya TZS ${val}!` : `You won TZS ${val} Voucher!`;
            const linkText = lang === 'sw' ? "TOA PESA (WHATSAPP)" : "WITHDRAW (WHATSAPP)";
            
            document.getElementById('p-title').innerText = t;
            document.getElementById('p-body').innerText = b;
            document.getElementById('claim-area').innerHTML = `
                <a href="https://wa.me/${WHATSAPP_NUMBER}?text=Habari, nimeshinda Vocha ya ${val}. ID: ${id}" 
                   target="_blank" class="claim-btn" style="display:block; text-align:center; padding:15px; margin-top:10px;" 
                   onclick="markUsed(${id})">${linkText}</a>`;
            document.getElementById('popup').style.display = "block";
        }

        function saveWin(val, id) {
            let h = JSON.parse(localStorage.getItem("testWins") || "[]");
            h.push({val, id, time: new Date().toLocaleTimeString(), used: false});
            localStorage.setItem("testWins", JSON.stringify(h));
        }

        function markUsed(id) {
            let h = JSON.parse(localStorage.getItem("testWins") || "[]");
            h = h.map(i => i.id == id ? {...i, used: true} : i);
            localStorage.setItem("testWins", JSON.stringify(h));
            setTimeout(updateUI, 500);
        }

        function renderHistory() {
            let h = JSON.parse(localStorage.getItem("testWins") || "[]");
            const div = document.getElementById('v-list');
            div.innerHTML = h.reverse().map(i => `
                <div class="v-item">
                    <span style="color:${i.used ? '#444':'#2ecc71'}">Vocha ${i.val} (ID: ${i.id})</span>
                    ${i.used ? 
                        `<span class="used-btn">IMETUMIKA</span>` : 
                        `<a href="https://wa.me/${WHATSAPP_NUMBER}?text=Nimeshinda ${i.val}. ID: ${i.id}" class="claim-btn" onclick="markUsed(${i.id})">WITHDRAW</a>`}
                </div>
            `).join('');
        }

        function pop(t, b) {
            document.getElementById('p-title').innerText = t;
            document.getElementById('p-body').innerText = b;
            document.getElementById('claim-area').innerHTML = "";
            document.getElementById('popup').style.display = "block";
        }

        function closePopup() { document.getElementById('popup').style.display = "none"; }
        function setLang(l) { lang = l; updateUI(); }

        updateUI();
    </script>
</body>
</html>
      const last = localStorage.getItem("lastSpin");
            const diff = new Date().getTime() - (last || 0);
            const isLock = last && diff < 10*60*60*1000;
            const btn = document.getElementById('spin-btn');
            const msg = document.getElementById('msg');

            if (isLock) {
                btn.innerText = t.bSpin;
                if (coins < 100) {
                    btn.className = "btn-locked"; btn.disabled = true;
                    msg.innerText = t.need + (100 - coins);
                } else {
                    btn.className = "btn-ready"; btn.disabled = false;
                    msg.innerText = t.bMsg;
                }
            } else {
                btn.innerText = t.fSpin; btn.className = "btn-ready"; btn.disabled = false;
                msg.innerText = t.fReady;
            }
            renderHistory();
        }

        function openPay(c, p) {
            pendingPackage = { c, p };
            const t = i18n[lang];
            document.getElementById('pay-title').innerText = t.payT;
            document.getElementById('pay-desc').innerText = t.payD + p + "/=";
            document.getElementById('pay-confirm-btn').innerText = t.confirm;
            document.getElementById('pay-cancel-btn').innerText = t.cancel;
            document.getElementById('pay-modal').style.display = "block";
        }

        function processPayment() {
            const phone = document.getElementById('phone-input').value;
            if (phone.length < 10) {
                alert(lang === 'sw' ? "Weka namba sahihi ya simu!" : "Enter a valid phone number!");
                return;
            }
            alert(lang === 'sw' ? "Tafadhali kamilisha malipo kwenye simu yako kwa PIN." : "Please complete payment on your phone with your PIN.");
            setTimeout(() => {
                coins += pendingPackage.c;
                update();
                closePay();
                alert(lang === 'sw' ? "Hongera! Malipo yamefanikiwa." : "Congrats! Payment successful.");
            }, 2000);
        }

        function closePay() { document.getElementById('pay-modal').style.display = "none"; }

        function doSpin() {
            const last = localStorage.getItem("lastSpin");
            const isBonus = last && (new Date().getTime() - last < 10*60*60*1000);
            if (isBonus) { coins -= 100; update(); }

            document.getElementById('spin-btn').disabled = true;
            const deg = 7200 + Math.floor(Math.random() * 3600);
            wheel.style.transform = `rotate(${deg}deg)`;

            setTimeout(() => {
                if (!isBonus) localStorage.setItem("lastSpin", new Date().getTime());
                let r = Math.random() * 100;
                let res = (r < 85) ? segments[0] : (r < 95 ? segments[3] : segments[2]);
                const t = i18n[lang];
                if (res.type === 'v') { saveWin(res.v); pop(t.winT, t.winB + res.v); }
                else if (res.type === 'c') { coins += res.v; pop(t.coinT, t.coinB + res.v); }
                else { pop(t.loseT, t.loseB); }
                update();
            }, 8200);
        }

        function saveWin(a) {
            let h = JSON.parse(localStorage.getItem("vHistory") || "[]");
            h.push({a, d: new Date().toLocaleTimeString()});
            localStorage.setItem("vHistory", JSON.stringify(h));
        }

        function renderHistory() {
            let h = JSON.parse(localStorage.getItem("vHistory") || "[]");
            const div = document.getElementById('v-list');
            div.innerHTML = h.length > 0 ? h.reverse().map(i => `<div class="v-item"><span>Vocha ${i.a}</span><span>${i.d}</span></div>`).join('') : `<div style="color:#333; font-size:11px; text-align:center;">${i18n[lang].empty}</div>`;
        }

        function pop(t, b) { document.getElementById('p-title').innerText = t; document.getElementById('p-body').innerText = b; document.getElementById('popup').style.display = "block"; }
        function closePopup() { document.getElementById('popup').style.display = "none"; update(); }

        update();
    </script>
</body>
</html>
